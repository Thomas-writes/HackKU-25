<!DOCTYPE html>
<html>
<head>
  <title>Spot-A-Song</title>
  <link rel="stylesheet" href="outstyles.css">
  <link href='https://fonts.googleapis.com/css?family=Gabarito' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
</head>
<body>

  <div id="topBar">
    <img src="../icon.png" alt="logo" id="logo">
    <h1 id="t">spot-a-song</h1>
  </div>

  <div id="button-container">
    <div class="square-box">
      <img class="square-box" src="" alt="playlist cover" id="playlist">
    </div>
    <button onclick="regen()" id="generation">generate again</button>
    <button id="create">send to spotify</button>
  </div>

  <div id="song-section">
    <h1 id="song-list-title">songs:</h1>
    <ul class="song-list" id="main"></ul>
  </div>

  <script>
    function regen() {
      window.close(); 
    }

    window.addEventListener('message', function(event) {
      console.log("Message received:", event.data);
      const { titleArray, artistArray, albumArray, spotifyURLArray, imageArray } = event.data;

      const playlist_cover = document.getElementById("playlist");
      const mainList = document.getElementById('main');
      mainList.innerHTML = '';

      function generate(aname, img, sname) {
        const songElement = document.createElement('li');
        const image = document.createElement('img');
        const info = document.createElement('div');
        const title = document.createElement('div');
        const artist = document.createElement('div');

        songElement.className = "song-item";
        image.className = "album-art";
        image.src = img;
        image.style.height = "100px";
        image.style.width = "100px";

        info.className = "song-info";
        title.className = "song-title";
        artist.className = "artist-name";

        title.innerHTML = sname;
        artist.innerHTML = aname;

        title.style.color = "#143150";
        title.style.paddingLeft = "10px";
        title.style.fontSize = "25px";
        artist.style.color = "#C2EFB3";
        artist.style.fontSize = "15px";
        artist.style.paddingLeft = "15px";

        info.appendChild(title);
        info.appendChild(artist);
        songElement.appendChild(image);
        songElement.appendChild(info);
        mainList.appendChild(songElement);
      }

      playlist_cover.src = imageArray[0];

      for (let i = 0; i < titleArray.length; i++) {
        generate(artistArray[i], imageArray[i], titleArray[i]);
      }

      localStorage.setItem("spotifyURIArray", JSON.stringify(event.data.spotifyURIArray));
    });
  </script>

  <script type="module" src="../playlist.js" defer></script>
</body>
</html>
